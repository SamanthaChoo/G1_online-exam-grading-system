{% extends 'base.html' %}
{% block title %}Course Results - {{ course.name }}{% endblock %}
{% block content %}

<style>
  .course-results-header {
    border-radius: 1rem;
    background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
    color: white;
    box-shadow: 0 0.5rem 1rem rgba(250, 112, 154, 0.3);
  }
  .exam-result-card {
    border-radius: 0.75rem;
    border: none;
    box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
    transition: all 0.2s;
    margin-bottom: 1rem;
    overflow: hidden;
  }
  .exam-result-card:hover {
    box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.1);
    transform: translateY(-3px);
  }
  .exam-status-bar {
    height: 4px;
    width: 100%;
  }
  .metric-box {
    padding: 1rem;
    border-radius: 0.5rem;
    background: #f8f9fa;
    border-left: 4px solid #667eea;
  }
</style>

<div class="container py-4">
  <!-- Header Card -->
  <div class="card border-0 course-results-header mb-4">
    <div class="card-body p-4">
      <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
        <div>
          <h2 class="h3 mb-2">
            <i class="bi bi-graph-up me-2"></i>{{ course.name }} - Exam Results
          </h2>
          <p class="mb-0 opacity-90">
            <i class="bi bi-tag me-2"></i>{{ course.code }}
          </p>
        </div>
        <div class="d-flex gap-2">
          <a href="/exams/results/lecturer" class="btn btn-light">
            <i class="bi bi-arrow-left me-2"></i>All Courses
          </a>
          <a href="/exams/course/{{ course.id }}" class="btn btn-light">
            <i class="bi bi-list-ul me-2"></i>View Exams
          </a>
        </div>
      </div>
    </div>
  </div>

  {% if exam_results %}
  <!-- Exams List -->
  {% for item in exam_results %}
  <div class="exam-result-card">
    {% if item.total_students > 0 %}
      {% if item.avg_percentage >= 70 %}
        <div class="exam-status-bar bg-success"></div>
      {% elif item.avg_percentage >= 50 %}
        <div class="exam-status-bar bg-warning"></div>
      {% else %}
        <div class="exam-status-bar bg-danger"></div>
      {% endif %}
    {% else %}
      <div class="exam-status-bar bg-secondary"></div>
    {% endif %}
    
    <div class="card-body p-4">
      <div class="row align-items-center">
        <!-- Exam Info -->
        <div class="col-md-8">
          <h5 class="mb-2">{{ item.exam.title }}</h5>
          <div class="d-flex flex-wrap gap-2 mb-3">
            <span class="badge bg-secondary-subtle text-secondary">
              <i class="bi bi-card-text me-1"></i>{{ item.exam.subject }}
            </span>
            {% if item.exam.start_time %}
            <span class="badge bg-info-subtle text-info">
              <i class="bi bi-calendar3 me-1"></i>{{ item.exam.start_time.strftime('%d %b %Y') }}
            </span>
            {% endif %}
            <span class="badge bg-warning-subtle text-warning">
              <i class="bi bi-clock me-1"></i>{{ item.exam.duration_minutes }} min
            </span>
          </div>

          {% if item.total_students > 0 %}
          <!-- Metrics Grid -->
          <div class="row g-2">
            <div class="col-md-3 col-6">
              <div class="metric-box border-primary">
                <small class="text-muted d-block">Students</small>
                <strong class="h5 mb-0">{{ item.total_students }}</strong>
              </div>
            </div>
            <div class="col-md-3 col-6">
              <div class="metric-box border-success">
                <small class="text-muted d-block">Avg Score</small>
                <strong class="h5 mb-0">{{ "%.1f"|format(item.avg_percentage) }}%</strong>
              </div>
            </div>
            <div class="col-md-3 col-6">
              <div class="metric-box border-info">
                <small class="text-muted d-block">Highest</small>
                <strong class="h5 mb-0">{{ item.highest_score }}/{{ item.total_questions }}</strong>
              </div>
            </div>
            <div class="col-md-3 col-6">
              <div class="metric-box border-danger">
                <small class="text-muted d-block">Lowest</small>
                <strong class="h5 mb-0">{{ item.lowest_score }}/{{ item.total_questions }}</strong>
              </div>
            </div>
          </div>
          {% else %}
          <div class="alert alert-light mb-0">
            <i class="bi bi-info-circle me-2"></i>No students have completed this exam yet.
          </div>
          {% endif %}
        </div>

        <!-- Action Column -->
        <div class="col-md-4 text-md-end mt-3 mt-md-0">
          <div class="d-flex flex-column gap-2">
            {% if item.total_students > 0 %}
            <a href="/exams/results/exam/{{ item.exam.id }}" class="btn btn-primary">
              <i class="bi bi-people-fill me-2"></i>View Student Results
            </a>
            {% endif %}
            <a href="/exams/{{ item.exam.id }}" class="btn btn-outline-secondary">
              <i class="bi bi-eye me-2"></i>Exam Details
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
  {% endfor %}
  {% else %}
  <!-- Empty State -->
  <div class="card border-0 shadow-sm" style="border-radius: 1rem;">
    <div class="card-body text-center py-5">
      <div class="mb-4">
        <i class="bi bi-inbox" style="font-size: 5rem; color: #dee2e6;"></i>
      </div>
      <h4 class="text-muted mb-3">No Exams Found</h4>
      <p class="text-muted mb-4">
        This course doesn't have any exams yet.<br>
        Create an exam to start tracking results.
      </p>
      <a href="/exams/new?course_id={{ course.id }}" class="btn btn-primary">
        <i class="bi bi-plus-circle me-2"></i>Create Exam
      </a>
    </div>
  </div>
  {% endif %}
</div>

{% endblock %}
