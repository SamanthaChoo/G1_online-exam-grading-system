{% extends 'base.html' %}
{% block title %}Exam Results{% endblock %}
{% block content %}

<style>
  .results-header-card {
    border-radius: 1rem;
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    color: white;
    box-shadow: 0 0.5rem 1rem rgba(240, 147, 251, 0.3);
  }
  .results-header-card .card-body {
    padding: 2rem;
  }
  .results-header-card h2,
  .results-header-card p {
    color: white;
    margin: 0;
  }
  .stats-card {
    border-radius: 1rem;
    border: none;
    box-shadow: 0 0.25rem 0.5rem rgba(0, 0, 0, 0.08);
    transition: transform 0.2s, box-shadow 0.2s;
  }
  .stats-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
  }
  .stats-icon {
    width: 60px;
    height: 60px;
    border-radius: 1rem;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.75rem;
  }
  .result-item-card {
    border-radius: 0.75rem;
    border: none;
    box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
    transition: all 0.2s;
    margin-bottom: 1rem;
  }
  .result-item-card:hover {
    box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.1);
    transform: translateX(5px);
  }
  .result-badge {
    padding: 0.5rem 1rem;
    border-radius: 2rem;
    font-weight: 600;
    font-size: 1rem;
  }
  .grade-circle {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    font-weight: 700;
    font-size: 1.25rem;
    box-shadow: 0 0.25rem 0.5rem rgba(0, 0, 0, 0.1);
  }
  .grade-A { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); color: white; }
  .grade-B { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; }
  .grade-C { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); color: white; }
  .grade-D { background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%); color: #333; }
  .grade-F { background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%); color: white; }
  
  .mini-progress {
    height: 8px;
    border-radius: 1rem;
    background: #e9ecef;
    overflow: hidden;
  }
  .mini-progress-bar {
    height: 100%;
    border-radius: 1rem;
    transition: width 0.3s;
  }
</style>

<div class="container py-4">
  <!-- Header Card -->
  <div class="card border-0 results-header-card mb-4">
    <div class="card-body">
      <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
        <div>
          <h2 class="h3 mb-2">
            <i class="bi bi-trophy-fill me-2"></i>My Exam Results
          </h2>
          {% if student %}
          <p class="mb-0 opacity-90">
            {{ student.name }} ({{ student.matric_no }})
          </p>
          {% endif %}
        </div>
        <div class="d-flex gap-2 flex-wrap">
          <a href="/exams/schedule/student/{{ student.id }}" class="btn btn-light">
            <i class="bi bi-calendar-event me-2"></i>Exam Schedule
          </a>
          <a href="/courses/student" class="btn btn-light">
            <i class="bi bi-book me-2"></i>My Courses
          </a>
        </div>
      </div>
    </div>
  </div>

  {% if results %}
  <!-- Statistics Cards -->
  <div class="row g-3 mb-4">
    <div class="col-md-3 col-sm-6">
      <div class="card stats-card">
        <div class="card-body">
          <div class="d-flex align-items-center">
            <div class="stats-icon bg-primary-subtle text-primary me-3">
              <i class="bi bi-file-text-fill"></i>
            </div>
            <div>
              <h6 class="text-muted mb-1 small">Total Exams</h6>
              <h3 class="mb-0">{{ total_exams }}</h3>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="col-md-3 col-sm-6">
      <div class="card stats-card">
        <div class="card-body">
          <div class="d-flex align-items-center">
            <div class="stats-icon bg-success-subtle text-success me-3">
              <i class="bi bi-check-circle-fill"></i>
            </div>
            <div>
              <h6 class="text-muted mb-1 small">Total Score</h6>
              <h3 class="mb-0">{{ total_score }}</h3>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="col-md-3 col-sm-6">
      <div class="card stats-card">
        <div class="card-body">
          <div class="d-flex align-items-center">
            <div class="stats-icon bg-info-subtle text-info me-3">
              <i class="bi bi-question-circle-fill"></i>
            </div>
            <div>
              <h6 class="text-muted mb-1 small">Total Questions</h6>
              <h3 class="mb-0">{{ total_questions }}</h3>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="col-md-3 col-sm-6">
      <div class="card stats-card">
        <div class="card-body">
          <div class="d-flex align-items-center">
            <div class="stats-icon bg-warning-subtle text-warning me-3">
              <i class="bi bi-star-fill"></i>
            </div>
            <div>
              <h6 class="text-muted mb-1 small">Overall Average</h6>
              <h3 class="mb-0">{{ "%.1f"|format(overall_percentage) }}%</h3>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Results List -->
  <div class="card border-0 shadow-sm" style="border-radius: 1rem;">
    <div class="card-header bg-white border-bottom" style="border-radius: 1rem 1rem 0 0;">
      <div class="d-flex justify-content-between align-items-center">
        <h5 class="mb-0">
          <i class="bi bi-list-check me-2"></i>Exam Results History
        </h5>
        <span class="badge bg-primary">{{ total_exams }} Results</span>
      </div>
    </div>
    <div class="card-body p-3">
      {% for item in results %}
      <div class="result-item-card">
        <div class="card-body">
          <div class="row align-items-center g-3">
            <!-- Grade Circle -->
            <div class="col-auto">
              {% set percentage = item.percentage %}
              {% if percentage >= 80 %}
                {% set grade = "A" %}
                {% set grade_class = "grade-A" %}
              {% elif percentage >= 70 %}
                {% set grade = "B" %}
                {% set grade_class = "grade-B" %}
              {% elif percentage >= 60 %}
                {% set grade = "C" %}
                {% set grade_class = "grade-C" %}
              {% elif percentage >= 50 %}
                {% set grade = "D" %}
                {% set grade_class = "grade-D" %}
              {% else %}
                {% set grade = "F" %}
                {% set grade_class = "grade-F" %}
              {% endif %}
              <div class="grade-circle {{ grade_class }}">
                <span>{{ grade }}</span>
                <small style="font-size: 0.7rem; font-weight: 500;">{{ "%.0f"|format(percentage) }}%</small>
              </div>
            </div>
            
            <!-- Exam Info -->
            <div class="col">
              <h5 class="mb-1">{{ item.exam.title }}</h5>
              <div class="d-flex flex-wrap gap-2 mb-2">
                {% if item.type == "MCQ" %}
                  <span class="badge bg-success">
                    <i class="bi bi-ui-checks me-1"></i>MCQ
                  </span>
                {% elif item.type == "Essay" %}
                  <span class="badge bg-primary">
                    <i class="bi bi-pencil-square me-1"></i>Essay
                  </span>
                {% endif %}
                <span class="badge bg-secondary-subtle text-secondary">
                  <i class="bi bi-bookmark-fill me-1"></i>{{ item.course.name }}
                </span>
                <span class="badge bg-info-subtle text-info">
                  <i class="bi bi-calendar3 me-1"></i>{{ item.result.graded_at.strftime('%d %b %Y') }}
                </span>
                <span class="badge bg-warning-subtle text-warning">
                  <i class="bi bi-clock me-1"></i>{{ item.result.graded_at.strftime('%H:%M') }}
                </span>
              </div>
              
              <!-- Score Progress Bar -->
              <div class="d-flex align-items-center gap-2 mb-1">
                <small class="text-muted" style="min-width: 100px;">
                  Score: <strong>{{ item.result.score }} / {{ item.result.total_questions }}</strong>
                </small>
                <div class="mini-progress flex-grow-1">
                  {% if percentage >= 80 %}
                    <div class="mini-progress-bar bg-success" style="width: {{ percentage }}%"></div>
                  {% elif percentage >= 60 %}
                    <div class="mini-progress-bar bg-info" style="width: {{ percentage }}%"></div>
                  {% elif percentage >= 40 %}
                    <div class="mini-progress-bar bg-warning" style="width: {{ percentage }}%"></div>
                  {% else %}
                    <div class="mini-progress-bar bg-danger" style="width: {{ percentage }}%"></div>
                  {% endif %}
                </div>
              </div>
            </div>
            
            <!-- Action Button -->
            <div class="col-auto">
              <a href="/exams/{{ item.exam.id }}" class="btn btn-outline-primary btn-sm">
                <i class="bi bi-eye me-1"></i>View Details
              </a>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
  {% else %}
  <!-- Empty State -->
  <div class="card border-0 shadow-sm" style="border-radius: 1rem;">
    <div class="card-body text-center py-5">
      <div class="mb-4">
        <i class="bi bi-clipboard-x" style="font-size: 5rem; color: #dee2e6;"></i>
      </div>
      <h4 class="text-muted mb-3">No Results Yet</h4>
      <p class="text-muted mb-4">
        You haven't completed any exams yet.<br>
        Once you complete and submit exams, your results will appear here.
      </p>
      <a href="/exams/schedule/student/{{ student.id }}" class="btn btn-primary">
        <i class="bi bi-calendar-event me-2"></i>View Exam Schedule
      </a>
    </div>
  </div>
  {% endif %}
</div>

{% endblock %}
