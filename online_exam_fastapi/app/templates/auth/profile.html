{% extends "base.html" %}

{% block content %}
<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-md-8 col-lg-7">
      <div class="card shadow-sm border-0">
        <div class="card-body p-4">
          <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="h4 mb-0">My Profile</h1>
            <a href="/auth/profile/edit" class="btn btn-outline-primary btn-sm">
              <i class="bi bi-pencil me-1"></i>Edit Profile
            </a>
          </div>

          {% if request.query_params.get("password_changed") %}
          <div class="alert alert-success alert-dismissible fade show" role="alert">
            <i class="bi bi-check-circle me-2"></i>Password changed successfully!
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
          {% endif %}

          {% if request.query_params.get("updated") %}
          <div class="alert alert-success alert-dismissible fade show" role="alert">
            <i class="bi bi-check-circle me-2"></i>Profile updated successfully!
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
          {% endif %}

          <div class="row mb-4">
            <div class="col-md-6">
              <h5 class="text-muted mb-3">Account Information</h5>
              <table class="table table-borderless">
                <tr>
                  <th width="40%" class="text-muted">Name:</th>
                  <td>{{ current_user.name }}</td>
                </tr>
                <tr>
                  <th class="text-muted">Email:</th>
                  <td>{{ current_user.email }}</td>
                </tr>
                <tr>
                  <th class="text-muted">Role:</th>
                  <td><span class="badge bg-primary">{{ current_user.role|capitalize }}</span></td>
                </tr>
                {% if current_user.role == "lecturer" %}
                <tr>
                  <th class="text-muted">Title:</th>
                  <td>{{ current_user.title or "Not set" }}</td>
                </tr>
                <tr>
                  <th class="text-muted">Staff ID:</th>
                  <td>{{ current_user.staff_id or "Not set" }}</td>
                </tr>
                {% endif %}
                {% if current_user.phone %}
                <tr>
                  <th class="text-muted">Phone:</th>
                  <td>{{ current_user.phone }}</td>
                </tr>
                {% endif %}
                <tr>
                  <th class="text-muted">Account Status:</th>
                  <td>
                    {% if current_user.is_active %}
                    <span class="badge bg-success">Active</span>
                    {% else %}
                    <span class="badge bg-danger">Inactive</span>
                    {% endif %}
                  </td>
                </tr>
                {% if current_user.last_login %}
                <tr>
                  <th class="text-muted">Last Login:</th>
                  <td>{{ current_user.last_login.strftime("%Y-%m-%d %H:%M:%S") }}</td>
                </tr>
                {% endif %}
                <tr>
                  <th class="text-muted">Member Since:</th>
                  <td>{{ current_user.created_at.strftime("%Y-%m-%d") }}</td>
                </tr>
              </table>
            </div>

            {% if current_user.role == "student" and student %}
            <div class="col-md-6">
              <h5 class="text-muted mb-3">Student Information</h5>
              <table class="table table-borderless">
                <tr>
                  <th width="40%" class="text-muted">Student ID:</th>
                  <td>{{ student.matric_no }}</td>
                </tr>
                {% if student.program %}
                <tr>
                  <th class="text-muted">Program:</th>
                  <td>{{ student.program }}</td>
                </tr>
                {% endif %}
                {% if student.year_of_study %}
                <tr>
                  <th class="text-muted">Year of Study:</th>
                  <td>{{ student.year_of_study }}</td>
                </tr>
                {% endif %}
                {% if student.phone_number %}
                <tr>
                  <th class="text-muted">Phone Number:</th>
                  <td>{{ student.phone_number }}</td>
                </tr>
                {% endif %}
                {% if student.gpa %}
                <tr>
                  <th class="text-muted">GPA:</th>
                  <td>{{ "%.2f"|format(student.gpa) }}</td>
                </tr>
                {% endif %}
              </table>
            </div>
            {% endif %}
          </div>

          <div class="d-flex gap-2 mt-4">
            <a href="/auth/profile/edit" class="btn btn-primary">
              <i class="bi bi-pencil me-1"></i>Edit Profile
            </a>
            <a href="/auth/profile/change-password" class="btn btn-outline-secondary">
              <i class="bi bi-key me-1"></i>Change Password
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
